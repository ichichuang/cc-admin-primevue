# cc-admin Vue3 + TypeScript è§„èŒƒ

## ğŸ¯ åŸºæœ¬åŸåˆ™

- **ä¸¥æ ¼ç±»å‹å®‰å…¨**: æ‰€æœ‰ç»„ä»¶ã€å‡½æ•°ã€APIå¿…é¡»æä¾›å‡†ç¡®çš„ç±»å‹å®šä¹‰
- **é›¶å®¹å¿any**: é¿å…ä½¿ç”¨ `any` ç±»å‹ï¼Œä¼˜å…ˆä½¿ç”¨ `unknown` æˆ–å…·ä½“ç±»å‹
- **æ¥å£ä¼˜å…ˆ**: ä½¿ç”¨ `interface` å®šä¹‰å¯¹è±¡ç»“æ„ï¼Œ`type` å®šä¹‰è”åˆç±»å‹å’Œå·¥å…·ç±»å‹
- **å¯¼å‡ºå…¬å…±ç±»å‹**: æ‰€æœ‰å…¬å…±æ¥å£ç±»å‹å¿…é¡»å¯¼å‡ºï¼Œæ–¹ä¾¿å¤ç”¨
- **ç¼–è¯‘é›¶é”™è¯¯**: ç¡®ä¿ç¼–è¯‘è¿‡ç¨‹ä¸­æ— ä»»ä½•ç±»å‹é”™è¯¯æˆ–è­¦å‘Š
- **ç±»å‹å³æ–‡æ¡£**: é€šè¿‡å®Œå–„çš„ç±»å‹å®šä¹‰æ›¿ä»£éƒ¨åˆ†æ–‡æ¡£

## ğŸ§© Vue 3 ç»„ä»¶ç±»å‹å®šä¹‰

### ç»„ä»¶Propsç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šå®šä¹‰ç»„ä»¶Propsæ¥å£
interface UserCardProps {
  // åŸºç¡€å±æ€§
  userId: string
  userName: string
  userEmail?: string                    // å¯é€‰å±æ€§
  isActive: boolean                     // å¸ƒå°”å€¼
  userRole: 'admin' | 'user' | 'guest' // è”åˆç±»å‹

  // å¯¹è±¡å±æ€§
  userProfile: UserProfile
  userSettings?: Partial<UserSettings>  // å¯é€‰çš„éƒ¨åˆ†ç±»å‹

  // æ•°ç»„å±æ€§
  permissions: string[]
  tags: readonly string[]               // åªè¯»æ•°ç»„

  // å‡½æ•°å±æ€§
  onUserClick?: (user: User) => void
  onStatusChange?: (status: UserStatus) => Promise<void>

  // æ’æ§½å†…å®¹
  headerSlot?: string | VNode
  footerSlot?: () => VNode[]
}

// âœ… æ­£ç¡®ï¼šç»„ä»¶å®šä¹‰
<script setup lang="ts">
// ä½¿ç”¨ withDefaults å®šä¹‰é»˜è®¤å€¼
const props = withDefaults(defineProps<UserCardProps>(), {
  isActive: true,
  userRole: 'user',
  userEmail: '',
  permissions: () => [],
  tags: () => []
})
</script>
```

### ç»„ä»¶Eventsç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šå®šä¹‰ç»„ä»¶äº‹ä»¶ç±»å‹
interface UserCardEmits {
  'user-click': [user: User]                    // å•ä¸ªå‚æ•°
  'status-change': [userId: string, status: UserStatus] // å¤šä¸ªå‚æ•°
  'update:active': [isActive: boolean]          // v-modelæ›´æ–°äº‹ä»¶
  'data-loaded': []                             // æ— å‚æ•°äº‹ä»¶
}

<script setup lang="ts">
// å®šä¹‰äº‹ä»¶å‘å°„å™¨
const emit = defineEmits<UserCardEmits>()

// äº‹ä»¶å¤„ç†å‡½æ•°
const handleUserClick = (user: User) => {
  emit('user-click', user)
}

const handleStatusToggle = () => {
  const newStatus: UserStatus = props.isActive ? 'inactive' : 'active'
  emit('status-change', props.userId, newStatus)
  emit('update:active', !props.isActive)
}
</script>
```

### ç»„ä»¶å®ä¾‹ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šå®šä¹‰ç»„ä»¶æš´éœ²çš„æ–¹æ³•
interface UserCardExpose {
  // DOMå…ƒç´ å¼•ç”¨
  rootElement: HTMLElement

  // å…¬å…±æ–¹æ³•
  focus: () => void
  refresh: () => Promise<void>
  updateUser: (userData: Partial<User>) => void

  // å“åº”å¼æ•°æ®è®¿é—®
  getUserData: () => Readonly<User>
  isLoading: Readonly<Ref<boolean>>
}

<script setup lang="ts">
// å®šä¹‰æ¨¡æ¿å¼•ç”¨
const rootRef = ref<HTMLElement>()
const isLoading = ref(false)

// å®šä¹‰å…¬å…±æ–¹æ³•
const focus = () => {
  rootRef.value?.focus()
}

const refresh = async () => {
  isLoading.value = true
  try {
    // åˆ·æ–°é€»è¾‘
  } finally {
    isLoading.value = false
  }
}

// æš´éœ²ç»™çˆ¶ç»„ä»¶
defineExpose<UserCardExpose>({
  rootElement: rootRef,
  focus,
  refresh,
  updateUser: (userData) => { /* æ›´æ–°é€»è¾‘ */ },
  getUserData: () => readonly(user.value),
  isLoading: readonly(isLoading)
})
</script>
```

## ğŸ“¦ Composition API ç±»å‹è§„èŒƒ

### Composableå‡½æ•°ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šå®šä¹‰ Composable æ¥å£
interface UseUserManagementOptions {
  autoRefresh?: boolean
  pollingInterval?: number
  cacheKey?: string
}

interface UseUserManagementReturn {
  // å“åº”å¼çŠ¶æ€
  userList: Ref<User[]>
  isLoading: Ref<boolean>
  error: Ref<Error | null>

  // è®¡ç®—å±æ€§
  activeUserCount: ComputedRef<number>
  hasUsers: ComputedRef<boolean>

  // æ–¹æ³•
  fetchUsers: () => Promise<User[]>
  createUser: (userData: CreateUserData) => Promise<User>
  updateUser: (userId: string, data: UpdateUserData) => Promise<User>
  deleteUser: (userId: string) => Promise<void>

  // å·¥å…·æ–¹æ³•
  clearCache: () => void
  refresh: () => Promise<void>
}

// âœ… æ­£ç¡®ï¼šå®ç° Composable
export function useUserManagement(options: UseUserManagementOptions = {}): UseUserManagementReturn {
  const userList = ref<User[]>([])
  const isLoading = ref(false)
  const error = ref<Error | null>(null)

  // è®¡ç®—å±æ€§å¿…é¡»æ˜ç¡®è¿”å›ç±»å‹
  const activeUserCount = computed(
    (): number => userList.value.filter(user => user.isActive).length
  )

  const hasUsers = computed((): boolean => userList.value.length > 0)

  // å¼‚æ­¥æ–¹æ³•å¿…é¡»å®šä¹‰å®Œæ•´çš„é”™è¯¯å¤„ç†
  const fetchUsers = async (): Promise<User[]> => {
    isLoading.value = true
    error.value = null

    try {
      const response = await userApi.getUserList()
      userList.value = response
      return response
    } catch (err) {
      error.value = err instanceof Error ? err : new Error('Unknown error')
      throw error.value
    } finally {
      isLoading.value = false
    }
  }

  return {
    userList,
    isLoading,
    error,
    activeUserCount,
    hasUsers,
    fetchUsers,
    createUser: async userData => {
      /* å®ç° */
    },
    updateUser: async (userId, data) => {
      /* å®ç° */
    },
    deleteUser: async userId => {
      /* å®ç° */
    },
    clearCache: () => {
      /* å®ç° */
    },
    refresh: fetchUsers,
  }
}
```

### å“åº”å¼ç±»å‹çº¦æŸ

```typescript
// âœ… æ­£ç¡®ï¼šå“åº”å¼æ•°æ®ç±»å‹å®šä¹‰
interface UserState {
  currentUser: User | null
  userList: User[]
  selectedUsers: Set<string>
  filters: UserFilters
  pagination: PaginationInfo
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç±»å‹çº¦æŸçš„å“åº”å¼çŠ¶æ€
const userState = reactive<UserState>({
  currentUser: null,
  userList: [],
  selectedUsers: new Set(),
  filters: {
    status: 'all',
    role: 'all',
    searchText: '',
  },
  pagination: {
    page: 1,
    pageSize: 20,
    total: 0,
  },
})

// âœ… æ­£ç¡®ï¼šç±»å‹å®‰å…¨çš„è®¡ç®—å±æ€§
const filteredUsers = computed((): User[] => {
  return userState.userList.filter(user => {
    // ç±»å‹å®‰å…¨çš„è¿‡æ»¤é€»è¾‘
    if (userState.filters.status !== 'all' && user.status !== userState.filters.status) {
      return false
    }
    if (userState.filters.role !== 'all' && user.role !== userState.filters.role) {
      return false
    }
    return true
  })
})
```

## ğŸ—‚ï¸ Pinia Store ç±»å‹è§„èŒƒ

### StoreçŠ¶æ€ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šStoreçŠ¶æ€æ¥å£
interface UserStoreState {
  // ç”¨æˆ·æ•°æ®
  currentUser: User | null
  userList: User[]
  userCache: Map<string, User>

  // çŠ¶æ€æ ‡å¿—
  isLoading: boolean
  isAuthenticated: boolean

  // é…ç½®ä¿¡æ¯
  preferences: UserPreferences
  permissions: string[]

  // å…ƒæ•°æ®
  lastSyncTime: Date | null
  version: string
}

// âœ… æ­£ç¡®ï¼šStoreå®šä¹‰
export const useUserStore = defineStore('user', {
  state: (): UserStoreState => ({
    currentUser: null,
    userList: [],
    userCache: new Map(),
    isLoading: false,
    isAuthenticated: false,
    preferences: getDefaultPreferences(),
    permissions: [],
    lastSyncTime: null,
    version: '1.0.0',
  }),

  getters: {
    // è®¡ç®—å±æ€§å¿…é¡»æ˜ç¡®è¿”å›ç±»å‹
    activeUsers(): User[] {
      return this.userList.filter(user => user.isActive)
    },

    hasAdminRole(): boolean {
      return this.permissions.includes('admin:all')
    },

    // å¸¦å‚æ•°çš„getter
    getUserById: state => {
      return (userId: string): User | undefined => {
        return state.userCache.get(userId) || state.userList.find(user => user.id === userId)
      }
    },
  },

  actions: {
    // å¼‚æ­¥æ“ä½œå¿…é¡»å®šä¹‰å®Œæ•´çš„ç±»å‹ç­¾å
    async fetchUserList(): Promise<User[]> {
      this.isLoading = true

      try {
        const users = await userApi.getUserList()
        this.userList = users

        // æ›´æ–°ç¼“å­˜
        users.forEach(user => {
          this.userCache.set(user.id, user)
        })

        this.lastSyncTime = new Date()
        return users
      } catch (error) {
        throw new Error(`Failed to fetch users: ${error}`)
      } finally {
        this.isLoading = false
      }
    },

    async createUser(userData: CreateUserData): Promise<User> {
      try {
        const newUser = await userApi.createUser(userData)
        this.userList.push(newUser)
        this.userCache.set(newUser.id, newUser)
        return newUser
      } catch (error) {
        throw new Error(`Failed to create user: ${error}`)
      }
    },
  },
})

// âœ… æ­£ç¡®ï¼šStoreç±»å‹å¯¼å‡º
export type UserStore = ReturnType<typeof useUserStore>
```

### StoreæŒä¹…åŒ–ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šæŒä¹…åŒ–é…ç½®ç±»å‹
interface UserStorePersistConfig {
  key: string
  storage: Storage
  paths: (keyof UserStoreState)[]
  serializer: {
    serialize: (value: any) => string
    deserialize: (value: string) => any
  }
}

// âœ… æ­£ç¡®ï¼šå¸¦æŒä¹…åŒ–çš„Store
export const useUserStore = defineStore(
  'user',
  {
    // ... state, getters, actions
  },
  {
    persist: {
      key: 'cc-admin-user-store',
      storage: localStorage,
      paths: ['currentUser', 'preferences', 'permissions'],
      serializer: {
        serialize: JSON.stringify,
        deserialize: JSON.parse,
      },
    } as UserStorePersistConfig,
  }
)
```

## ğŸŒ API å’Œ HTTP ç±»å‹è§„èŒƒ

### APIå“åº”ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šé€šç”¨APIå“åº”ç±»å‹
interface ApiResponse<T = any> {
  success: boolean
  data: T
  message: string
  code: number
  timestamp: string
}

interface PaginatedResponse<T> extends ApiResponse<T[]> {
  pagination: {
    page: number
    pageSize: number
    total: number
    totalPages: number
  }
}

interface ErrorResponse extends ApiResponse<null> {
  errors: Array<{
    field: string
    message: string
    code: string
  }>
}
```

### APIæ–¹æ³•ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šAPIæ¨¡å—ç±»å‹å®šä¹‰
interface UserApi {
  // GETæ–¹æ³•
  getUserList(params?: UserListParams): Promise<ApiResponse<User[]>>
  getUserById(id: string): Promise<ApiResponse<User>>

  // POSTæ–¹æ³•
  createUser(data: CreateUserData): Promise<ApiResponse<User>>

  // PUTæ–¹æ³•
  updateUser(id: string, data: UpdateUserData): Promise<ApiResponse<User>>

  // DELETEæ–¹æ³•
  deleteUser(id: string): Promise<ApiResponse<null>>

  // æ‰¹é‡æ“ä½œ
  batchUpdateUsers(updates: BatchUserUpdate[]): Promise<ApiResponse<User[]>>

  // æ–‡ä»¶ä¸Šä¼ 
  uploadAvatar(userId: string, file: File): Promise<ApiResponse<{ url: string }>>
}

// âœ… æ­£ç¡®ï¼šAPIå®ç°
export const userApi: UserApi = {
  async getUserList(params = {}) {
    const response = await request.get<ApiResponse<User[]>>('/users', { params })
    return response
  },

  async createUser(data) {
    const response = await request.post<ApiResponse<User>>('/users', data)
    return response
  },

  // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

## ğŸ”§ å·¥å…·ç±»å‹å’Œæ³›å‹

### è‡ªå®šä¹‰å·¥å…·ç±»å‹

```typescript
// âœ… æ­£ç¡®ï¼šä¸šåŠ¡ç›¸å…³çš„å·¥å…·ç±»å‹
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P]
}

type RequiredKeys<T, K extends keyof T> = T & Required<Pick<T, K>>

type OptionalKeys<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>

// è¡¨å•ç›¸å…³ç±»å‹
type FormData<T> = {
  [K in keyof T]: T[K] extends Date ? string : T[K]
}

type ValidationErrors<T> = Partial<Record<keyof T, string[]>>

// APIç›¸å…³ç±»å‹
type ApiEndpoint<TRequest = void, TResponse = any> = TRequest extends void
  ? () => Promise<ApiResponse<TResponse>>
  : (data: TRequest) => Promise<ApiResponse<TResponse>>
```

### æ¡ä»¶ç±»å‹ä½¿ç”¨

```typescript
// âœ… æ­£ç¡®ï¼šæ¡ä»¶ç±»å‹åœ¨ç»„ä»¶ä¸­çš„åº”ç”¨
type ComponentProps<T extends 'button' | 'link' | 'text'> = T extends 'button'
  ? ButtonProps
  : T extends 'link'
    ? LinkProps
    : TextProps

interface DynamicComponentProps<T extends 'button' | 'link' | 'text'> {
  type: T
  props: ComponentProps<T>
  children?: VNode[]
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ¡ä»¶ç±»å‹çš„ç»„ä»¶
function DynamicComponent<T extends 'button' | 'link' | 'text'>(props: DynamicComponentProps<T>) {
  // ç±»å‹å®‰å…¨çš„ç»„ä»¶æ¸²æŸ“é€»è¾‘
}
```

## ğŸ“ ç±»å‹å£°æ˜å’Œæ¨¡å—æ‰©å±•

### ç¯å¢ƒå˜é‡ç±»å‹

```typescript
// src/Types/env.d.ts
interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string
  readonly VITE_APP_TITLE: string
  readonly VITE_APP_VERSION: string
  readonly VITE_APP_ENV: 'development' | 'production' | 'test'
  readonly VITE_PINIA_PERSIST_KEY_PREFIX: string
  readonly VITE_ROOT_REDIRECT: string
  readonly VITE_LOADING_SIZE: 'small' | 'default' | 'large'
  readonly VITE_DEV_TOOLS: boolean
  readonly VITE_MOCK_ENABLE: boolean
  readonly VITE_CONSOLE_LOG: boolean
  readonly VITE_DEBUG: boolean
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
```

### è·¯ç”±ç±»å‹æ‰©å±•

```typescript
// src/Types/router.d.ts
import 'vue-router'

declare module 'vue-router' {
  interface RouteMeta {
    title?: string
    requiresAuth?: boolean
    permissions?: string[]
    layout?: 'admin' | 'screen' | 'fullscreen'
    hideInMenu?: boolean
    icon?: string
    order?: number
    cache?: boolean
    affix?: boolean
  }
}
```

### Pinia Storeç±»å‹æ‰©å±•

```typescript
// src/Types/stores.d.ts
import { Router } from 'vue-router'

declare module 'pinia' {
  export interface DefineStoreOptionsBase<S, Store> {
    // æ·»åŠ è·¯ç”±è®¿é—®
    router?: Router

    // æ·»åŠ æŒä¹…åŒ–é…ç½®
    persist?:
      | boolean
      | {
          key?: string
          storage?: Storage
          paths?: (keyof S)[]
        }
  }
}
```

## ğŸš« é¿å…çš„TypeScriptç”¨æ³•

### é”™è¯¯ç¤ºä¾‹

```typescript
// âŒ é”™è¯¯ï¼šä½¿ç”¨anyç±»å‹
const userData: any = {}

// âŒ é”™è¯¯ï¼šæœªå®šä¹‰è¿”å›ç±»å‹çš„å¤æ‚å‡½æ•°
function processUser(user) {
  // å¤æ‚é€»è¾‘
  return transformedUser
}

// âŒ é”™è¯¯ï¼šæœªçº¦æŸçš„æ³›å‹
function createEntity<T>(data: T) {
  return { ...data, id: generateId() }
}

// âŒ é”™è¯¯ï¼šç±»å‹æ–­è¨€æ»¥ç”¨
const element = document.getElementById('app') as HTMLElement

// âŒ é”™è¯¯ï¼šå¿½ç•¥Promiseé”™è¯¯ç±»å‹
async function fetchData() {
  try {
    return await api.getData()
  } catch (error) {
    console.log(error.message) // errorç±»å‹æœªçŸ¥
  }
}
```

### æ­£ç¡®ç¤ºä¾‹

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å…·ä½“ç±»å‹
const userData: User = {
  id: '1',
  name: 'John',
  email: 'john@example.com',
}

// âœ… æ­£ç¡®ï¼šæ˜ç¡®çš„å‡½æ•°ç­¾å
function processUser(user: User): ProcessedUser {
  // å¤æ‚é€»è¾‘
  return transformedUser
}

// âœ… æ­£ç¡®ï¼šçº¦æŸçš„æ³›å‹
interface Entity {
  id: string
}

function createEntity<T extends Partial<Entity>>(data: T): T & Entity {
  return { ...data, id: generateId() }
}

// âœ… æ­£ç¡®ï¼šå®‰å…¨çš„ç±»å‹æ£€æŸ¥
const element = document.getElementById('app')
if (element instanceof HTMLElement) {
  // å®‰å…¨ä½¿ç”¨element
}

// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†
async function fetchData(): Promise<ApiResponse<Data> | null> {
  try {
    return await api.getData()
  } catch (error) {
    if (error instanceof Error) {
      console.error('API Error:', error.message)
    } else {
      console.error('Unknown error:', error)
    }
    return null
  }
}
```

## ğŸ“‹ ç±»å‹æ£€æŸ¥å’ŒéªŒè¯

### è¿è¡Œæ—¶ç±»å‹éªŒè¯

```typescript
// âœ… æ­£ç¡®ï¼šç±»å‹å®ˆå«å‡½æ•°
function isUser(value: unknown): value is User {
  return (
    typeof value === 'object' &&
    value !== null &&
    'id' in value &&
    'name' in value &&
    'email' in value &&
    typeof (value as User).id === 'string' &&
    typeof (value as User).name === 'string' &&
    typeof (value as User).email === 'string'
  )
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç±»å‹å®ˆå«
function processUserData(data: unknown): User | null {
  if (isUser(data)) {
    return data // ç±»å‹å®‰å…¨
  }
  return null
}
```

### ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç±»å‹æ–­è¨€è¾…åŠ©å‡½æ•°
function assertIsUser(value: unknown): asserts value is User {
  if (!isUser(value)) {
    throw new Error('Invalid user data')
  }
}

// âœ… æ­£ç¡®ï¼šå®‰å…¨çš„ç±»å‹æ–­è¨€
try {
  assertIsUser(userData)
  // æ­¤å¤„userDataç¡®å®šæ˜¯Userç±»å‹
  console.log(userData.name)
} catch (error) {
  console.error('Type assertion failed:', error)
}
```

éµå¾ªè¿™äº›TypeScriptè§„èŒƒï¼Œç¡®ä¿cc-adminé¡¹ç›®å…·æœ‰å®Œæ•´çš„ç±»å‹å®‰å…¨ã€ä¼˜ç§€çš„å¼€å‘ä½“éªŒå’Œå¯ç»´æŠ¤çš„ä»£ç è´¨é‡ã€‚
